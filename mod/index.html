<script src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous">
  </script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.15/c3.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.15/c3.js"></script>

<script>
  const D2R = Math.PI / 180; // degree to radian
  var socket = null;

  function initWS() {
    setInterval(function () { keep_connect(); }, 1000);
    setInterval(function () { try_ping(); }, 1000);
  };

  const keep_connect = function () {
    if (socket == null) {
      socket = connect();
    } else if (socket.readyState == WebSocket.CONNECTING) {
      console.log("CONNECTING");
    } else if (socket.readyState == WebSocket.OPEN) {
      // nop
    } else if (socket.readyState == WebSocket.CLOSING) {
      console.log("CLOSING");
    } else if (socket.readyState == WebSocket.CLOSED) {
      console.log("CLOSED");
      socket = null;
    } else {
      console.log("readyState=", socket.readyState);
    }
  }

  const try_ping = function () {
    if (socket && socket.readyState == WebSocket.OPEN) {
      const ms = Date.now();
      if (socket.sent_ms == null || 1000 < ms - socket.sent_ms) {
        cmd("ping", { "seq": socket.seq, "ms": ms }).then((response) => {
          const ms = Date.now();
          const delay = ms - response.ms;
          if(100<=delay){
            console.log("!!! 100ms < delay=", delay);
          }
          socket.sent_ms = null;
          /*
          if (!socket._delay_prev_ms || 5000 < ms - socket._delay_prev_ms) {
            if (socket._delay_prev_ms) {
              console.log("ping-pong/sec=", 1000 * (socket._delay_prev_seq - socket.seq) / (socket._delay_prev_ms - ms));
            }
            socket._delay_prev_seq = socket.seq;
            socket._delay_prev_ms = ms;
          }
          */
        });
        socket.sent_ms = ms;
        socket.seq++;
      }
    }
  }

  const connect = function () {
    var ws_url = "";
    if (window.location.protocol == "file:") {
      ws_url = 'ws://spotsg90.local/ws';
    } else {
      ws_url = 'ws://' + window.location.host + ':' + window.location.port + '/ws';
    }

    const socket = new WebSocket(ws_url);

    socket.addEventListener('open', function (event) {
      cmd("hello", {}).then((response)=>{
        console.log("hello: ", response);
      });

      socket.seq = 0;
      socket.sent_ms = 0;
    });

    socket.addEventListener('message', function (event) {
      var resp = JSON.parse(event.data);
      if (resp.id) {
        receive(resp);
      }
    });

    socket.addEventListener('close', function (event) {
      console.log('close');
    });

    socket.addEventListener('error', function (event) {
      console.log('error');
    });

    return socket;
  }

  const waiting_list = new Map();
  let seq = 0;
  const cmd = function (name, request) {
    return new Promise((resolve, reject) => {
      const timestamp = Date.now();
      const id = timestamp + "-" + (seq++);
      const req = { "id": id, "cmd": name, "request": request };
      if(name!="ping"){ console.log(req.id, req.cmd, req.request); }
      socket.send(JSON.stringify(req));
      waiting_list.set(id, [timestamp, resolve, reject]);
    });
  }

  const receive = function (obj) {
    if(obj.cmd!="ping"){ console.log(obj.id, obj.cmd, obj.response, obj.error); }
    const [timestamp, resolve, reject] = waiting_list.get(obj.id);
    waiting_list.delete(obj.id);
    if (obj.response && resolve) {
      resolve(obj.response);
    }else if(reject){
      reject(obj.error);
    }
  };

  setInterval(() => {
    for (let [id, value] of waiting_list) {
      const [timestamp, resolve, reject] = value;
      if (10 * 1000 < Date.now() - timestamp) {
        waiting_list.delete(id);
        if (reject) {
          reject("timeout");
        }
      }
    }
  }, 1000);

  window.onload = function () {
    initWS();
    initUI();
    initTunesUI();
    initParamsUI();
    initCalibrationUI();
  }

  const initUI = function () {
    $("#wakeup").click(function(){
      cmd("dog.wakeup", { "xyz": 999 }).then((response) => {
      });
    });
    $("#sleep").click(function(){
      cmd("dog.sleep", { "abc": 123 }).then((response) => {
      });
    });
    $(".motion").click(function(){
      const name  = $(this).attr("name");
      const speed = $("#motion_speed").val();
      const args  = $(this).attr("args");
      cmd("dog.motion", { "name": name, "speed": speed, "args": JSON.parse(args) }).then((response) => {
      });
    });
    $("#motion_speed").on("input", function(){
      const speed  = $(this).val();
      queued_cmd.speed = speed;
    });
    let queued_cmd = {speed: null, busy: false};
    setInterval(function(){
      if(!queued_cmd.busy && queued_cmd.speed){
        cmd("dog.set_motion_speed", {speed: queued_cmd.speed}).then((response) => {
          console.log(response);
          queued_cmd.busy = false;
        });
        queued_cmd.busy = true;
        queued_cmd.speed = null;
      }
    }, 50);
  };

  const initParamsUI = function () {
    const slidersUI = initSlidersUI("params");
    const params = {
        "position": {x: 0,y: 65,z: 0},
        "rotation": {x: 0,y:  0,z: 0},
        "legs":[
          {"target":{"position":{x:  15, y: 0, z: -30}}},
          {"target":{"position":{x:  15, y: 0, z:  30}}},
          {"target":{"position":{x: -90, y: 0, z: -30}}},
          {"target":{"position":{x: -90, y: 0, z:  30}}}
        ]
      };
    $("#params .preset button[v=a]").click(function(){
      slidersUI.set_params(params)
    });
    $("#params .preset button[v=b]").click(function(){
      const p = JSON.parse(JSON.stringify(params));
      p.legs[0].target.position.y += 10;
      p.legs[3].target.position.y += 10;
      slidersUI.set_params(p)
    });
    $("#params .preset button[v=c]").click(function(){
      const p = JSON.parse(JSON.stringify(params));
      p.legs[1].target.position.y += 10;
      p.legs[2].target.position.y += 10;
      slidersUI.set_params(p)
    });
  };

  const initTunesUI = function () {
    const slidersUI = initSlidersUI("tunes");
    $("#tunes .preset button[v=zero]").click(function(){
      const tunes = {
        "position": {x:0,y:0,z:0},
        "rotation": {x:0,y:0,z:0},
        "legs":[
          {"target":{"position":{x:0,y:0,z:0}}},
          {"target":{"position":{x:0,y:0,z:0}}},
          {"target":{"position":{x:0,y:0,z:0}}},
          {"target":{"position":{x:0,y:0,z:0}}}
        ]
      };
      slidersUI.set_params(tunes)
    });
  };

  const initSlidersUI = function(key){
    const parent_id = "#"+key;
    const set_params = function(params){
      $(parent_id+" #position_x").val(params.position.x);
      $(parent_id+" #position_y").val(params.position.y);
      $(parent_id+" #position_z").val(params.position.z);
      $(parent_id+" #rotation_x").val(params.rotation.x);
      $(parent_id+" #rotation_y").val(params.rotation.y);
      $(parent_id+" #rotation_z").val(params.rotation.z);
      $(parent_id+" #leg0_position_x").val(params.legs[0].target.position.x);
      $(parent_id+" #leg0_position_y").val(params.legs[0].target.position.y);
      $(parent_id+" #leg0_position_z").val(params.legs[0].target.position.z);
      $(parent_id+" #leg1_position_x").val(params.legs[1].target.position.x);
      $(parent_id+" #leg1_position_y").val(params.legs[1].target.position.y);
      $(parent_id+" #leg1_position_z").val(params.legs[1].target.position.z);
      $(parent_id+" #leg2_position_x").val(params.legs[2].target.position.x);
      $(parent_id+" #leg2_position_y").val(params.legs[2].target.position.y);
      $(parent_id+" #leg2_position_z").val(params.legs[2].target.position.z);
      $(parent_id+" #leg3_position_x").val(params.legs[3].target.position.x);
      $(parent_id+" #leg3_position_y").val(params.legs[3].target.position.y);
      $(parent_id+" #leg3_position_z").val(params.legs[3].target.position.z);
      $(parent_id+" .slider").each((index, element)=>{
        update_text($(element));
      });
      const request = {};
      request[key] = params;
      cmd("dog.set_"+key, request).then((response) => {});
    }

    const update_text = function(slider){
      $("span", $(slider).parent()).text($(slider).val());
    }
    $(parent_id+" .slider").each((index, element)=>{
      update_text($(element));
    })

    $(parent_id+" .slider").on("input", function(){
      update_text($(this));
      const params = {
        "position": {
          x: parseFloat($(parent_id+" #position_x").val()),
          y: parseFloat($(parent_id+" #position_y").val()),
          z: parseFloat($(parent_id+" #position_z").val())
        },
        "rotation": {
          x: parseFloat($(parent_id+" #rotation_x").val()) * D2R,
          y: parseFloat($(parent_id+" #rotation_y").val()) * D2R,
          z: parseFloat($(parent_id+" #rotation_z").val()) * D2R
        },
        "legs": [
          {"target":{"position":{
            x: parseFloat($(parent_id+" #leg0_position_x").val()),
            y: parseFloat($(parent_id+" #leg0_position_y").val()),
            z: parseFloat($(parent_id+" #leg0_position_z").val())
          }}},
          {"target":{"position":{
            x: parseFloat($(parent_id+" #leg1_position_x").val()),
            y: parseFloat($(parent_id+" #leg1_position_y").val()),
            z: parseFloat($(parent_id+" #leg1_position_z").val())
          }}},
          {"target":{"position":{
            x: parseFloat($(parent_id+" #leg2_position_x").val()),
            y: parseFloat($(parent_id+" #leg2_position_y").val()),
            z: parseFloat($(parent_id+" #leg2_position_z").val())
          }}},
          {"target":{"position":{
            x: parseFloat($(parent_id+" #leg3_position_x").val()),
            y: parseFloat($(parent_id+" #leg3_position_y").val()),
            z: parseFloat($(parent_id+" #leg3_position_z").val())
          }}}
        ]
      };
      queued_cmd.params = params;
    });
    let queued_cmd = {params: null, busy: false};
    setInterval(function(){
      if(!queued_cmd.busy && queued_cmd.params){
        const request = {};
        request[key] = queued_cmd.params;
        cmd("dog.set_"+key, request).then((response) => {
          console.log(response);
          queued_cmd.busy = false;
        });
        queued_cmd.busy = true;
        queued_cmd.params = null;
      }
    }, 1);

    return {
      set_params: set_params
    }
  };

  const initCalibrationUI = function(){
    $("select[name=servo_number]").change(function(){
      var servo_number = parseInt($(this).val());
      cmd("dog.servo.get_calibration", {servo_number: servo_number}).then((response)=>{
        $("#calibration input[name=angle0]").val(response.calibration.angle0);
        $("#calibration input[name=pulse_width0]").val(response.calibration.pulse_width0);
        $("#calibration input[name=angle1]").val(response.calibration.angle1);
        $("#calibration input[name=pulse_width1]").val(response.calibration.pulse_width1);
        $("#calibration input[name=angle_min]").val(response.calibration.angle_min);
        $("#calibration input[name=angle_max]").val(response.calibration.angle_max);
        $("#calibration input[name=test_pulse_width]").val("");
      });
    });

    $("button[name=save_calibration]").click(function(){
      const servo_number = parseInt($("select[name=servo_number]").val());
      const request = {
          "calibration": {
            servo_number: servo_number,
            angle0:       parseInt($("#calibration input[name=angle0]").val()),
            pulse_width0: parseInt($("#calibration input[name=pulse_width0]").val()),
            angle1:       parseInt($("#calibration input[name=angle1]").val()),
            pulse_width1: parseInt($("#calibration input[name=pulse_width1]").val()),
            angle_min:    parseInt($("#calibration input[name=angle_min]").val()),
            angle_max:    parseInt($("#calibration input[name=angle_max]").val())
          }
        }
      cmd("dog.servo.update_calibration", request).then((response)=>{
        $("select[name=servo_number]").change();
      });
    });

    $("button.test_pulse_width").click(function(){
      var v = $(this).attr("v");
      if(v==""){
        v = parseInt($("input[name=test_pulse_width]").val());
      }else if(v.startsWith("+") || v.startsWith("-")){
        v = parseInt($("input[name=test_pulse_width]").val()) + parseInt(v);
      }else {
        v = parseInt(v);
      }
      if(400<=v && v<=2900){
        const servo_number = parseInt($("select[name=servo_number]").val());
        const pulse_width = v;
        cmd("dog.servo.set_pulse_width", {servo_number: servo_number, pulse_width: pulse_width}).then((response)=>{
          $("input[name=test_pulse_width]").val(response.pulse_width);
        });
      }
    });

    $("button.test_pulse_width_all").click(async function(){
      var v = $(this).attr("v");
      const ss = v.split(',');
      for(let i=0; i<ss.length; i++){
        const s = ss[i];
        var servo_number, pulse_width;
        [servo_number, pulse_width] = s.split("=").map(x=>parseInt(x.trim()));
        await cmd("dog.servo.set_pulse_width", {servo_number: servo_number, pulse_width: pulse_width});
      }
    });

    $("#calibration .preset button").click(function(){
      var v = $(this).attr("v");
      if(v=="test0"){
        cmd("dog.servo.set_leg_angles", {leg_number: 0, angle1:  0, angle2:  0, angle3: 0}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 1, angle1:  0, angle2:  0, angle3: 0}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 2, angle1:  0, angle2:  0, angle3: 0}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 3, angle1:  0, angle2:  0, angle3: 0}).then((response)=>{});
      }
      if(v=="test1"){
        cmd("dog.servo.set_leg_angles", {leg_number: 0, angle1:  0, angle2:  0, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 1, angle1:  0, angle2:  0, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 2, angle1:  0, angle2:  0, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 3, angle1:  0, angle2:  0, angle3: 90}).then((response)=>{});
      }
      if(v=="test2"){
        cmd("dog.servo.set_leg_angles", {leg_number: 0, angle1:  0, angle2: 45, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 1, angle1:  0, angle2: 45, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 2, angle1:  0, angle2: 45, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 3, angle1:  0, angle2: 45, angle3: 90}).then((response)=>{});
      }
      if(v=="test3"){
        cmd("dog.servo.set_leg_angles", {leg_number: 0, angle1:  0, angle2: 45, angle3:  0}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 1, angle1:  0, angle2: 45, angle3:  0}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 2, angle1:  0, angle2: 45, angle3:  0}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 3, angle1:  0, angle2: 45, angle3:  0}).then((response)=>{});
      }
      if(v=="test4"){
        cmd("dog.servo.set_leg_angles", {leg_number: 0, angle1:-20, angle2:  0, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 1, angle1:-20, angle2:  0, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 2, angle1:-20, angle2:  0, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 3, angle1:-20, angle2:  0, angle3: 90}).then((response)=>{});
      }
      if(v=="test5"){
        cmd("dog.servo.set_leg_angles", {leg_number: 0, angle1: 20, angle2:  0, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 1, angle1: 20, angle2:  0, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 2, angle1: 20, angle2:  0, angle3: 90}).then((response)=>{});
        cmd("dog.servo.set_leg_angles", {leg_number: 3, angle1: 20, angle2:  0, angle3: 90}).then((response)=>{});
      }
    });
  }

</script>


<div>
  <button id="wakeup">Wakeup</button>
  <button id="sleep">Sleep</button>
</div>

<div>
  <button class="motion" name="default" args='{}'>default</button>
  <button class="motion" name="dance"   args='{}'>dance</button>
  <button class="motion" name="walk"    args='{}'>walk</button>
  <button class="motion" name="step"    args='{}'>step</button>
  <button class="motion" name="STOP"    args='{}'>STOP</button>

  <input id="motion_speed" type="range" min="0.01", value="1.0" max="3.0" step="0.01">
</div>



<div id="tunes" class="sliders">
  <h3>tunes</h3>
  <div class="preset">
    <button v="zero">zero</button>
  </div>
  <div>
    <h4>position:</h4>
    <label>X:<span></span><input id="position_x" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Y:<span></span><input id="position_y" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Z:<span></span><input id="position_z" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
  </div>
  <div>
    <h4>rotation:</h4>
    <label>X:<span></span><input id="rotation_x" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Y:<span></span><input id="rotation_y" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Z:<span></span><input id="rotation_z" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
  </div>
  <div>
    <h4>leg[0]:</h4>
    <label>X:<span></span><input id="leg0_position_x" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Y:<span></span><input id="leg0_position_y" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Z:<span></span><input id="leg0_position_z" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
  </div>
  <div>
    <h4>leg[1]:</h4>
    <label>X:<span></span><input id="leg1_position_x" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Y:<span></span><input id="leg1_position_y" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Z:<span></span><input id="leg1_position_z" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
  </div>
  <div>
    <h4>leg[2]:</h4>
    <label>X:<span></span><input id="leg2_position_x" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Y:<span></span><input id="leg2_position_y" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Z:<span></span><input id="leg2_position_z" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
  </div>
  <div>
    <h4>leg[3]:</h4>
    <label>X:<span></span><input id="leg3_position_x" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Y:<span></span><input id="leg3_position_y" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
    <label>Z:<span></span><input id="leg3_position_z" class="slider" type="range" step="0.1" value="0" min="-20" max="20"></label>
  </div>
</div>

<style>
  .sliders h4{
    display: inline-block;
    width: 120px;
    margin: 0px;
  }
  .sliders div{
    padding: 2px;
    margin: 0px;
    border: 1px solid black;
  }
  .sliders label{
    display: inline-block;
    width: 300px;
    margin: 0px;
  }
  .sliders label input[type=range]{
    width: 200px;
    margin: 0px;
  }
  .sliders label span{
    display: inline-block;
    width: 30px;
    margin: 0px;
  }
</style>

<div id="params" class="sliders">
  <h3>params</h3>
  <div class="preset">
    <button v="a">a</button>
    <button v="b">b</button>
    <button v="c">c</button>
  </div>
  <div>
    <h4>position:</h4>
    <label>X:<span></span><input id="position_x" class="slider" type="range" step="0.1" value="" min="-30" max="30"></label>
    <label>Y:<span></span><input id="position_y" class="slider" type="range" step="0.1" value="" min="10"  max="75"></label>
    <label>Z:<span></span><input id="position_z" class="slider" type="range" step="0.1" value="" min="-30" max="30"></label>
  </div>
  <div>
    <h4>rotation:</h4>
    <label>X:<span></span><input id="rotation_x" class="slider" type="range" step="0.1" value="" min="-45" max="45"></label>
    <label>Y:<span></span><input id="rotation_y" class="slider" type="range" step="0.1" value="" min="-45" max="45"></label>
    <label>Z:<span></span><input id="rotation_z" class="slider" type="range" step="0.1" value="" min="-45" max="45"></label>
  </div>
  <div>
    <h4>leg[0]:</h4>
    <label>X:<span></span><input id="leg0_position_x" class="slider" type="range" step="0.1" value="" min="-15" max="45"></label>
    <label>Y:<span></span><input id="leg0_position_y" class="slider" type="range" step="0.1" value="" min="0"   max="60"></label>
    <label>Z:<span></span><input id="leg0_position_z" class="slider" type="range" step="0.1" value="" min="-80" max="-20"></label>
  </div>
  <div>
    <h4>leg[1]:</h4>
    <label>X:<span></span><input id="leg1_position_x" class="slider" type="range" step="0.1" value="" min="-15" max="45"></label>
    <label>Y:<span></span><input id="leg1_position_y" class="slider" type="range" step="0.1" value="" min="0"   max="60"></label>
    <label>Z:<span></span><input id="leg1_position_z" class="slider" type="range" step="0.1" value="" min="20"  max="80"></label>
  </div>
  <div>
    <h4>leg[2]:</h4>
    <label>X:<span></span><input id="leg2_position_x" class="slider" type="range" step="0.1" value="" min="-120" max="-60"></label>
    <label>Y:<span></span><input id="leg2_position_y" class="slider" type="range" step="0.1" value="" min="0"    max="60"></label>
    <label>Z:<span></span><input id="leg2_position_z" class="slider" type="range" step="0.1" value="" min="-80"  max="-20"></label>
  </div>
  <div>
    <h4>leg[3]:</h4>
    <label>X:<span></span><input id="leg3_position_x" class="slider" type="range" step="0.1" value="" min="-120" max="-60"></label>
    <label>Y:<span></span><input id="leg3_position_y" class="slider" type="range" step="0.1" value="" min="0"    max="60"></label>
    <label>Z:<span></span><input id="leg3_position_z" class="slider" type="range" step="0.1" value="" min="20"   max="80"></label>
  </div>
</div>



<style>
  #calibration h4{
    display: inline-block;
    width: 120px;
    margin: 0px;
  }
  #calibration div{
    padding: 2px;
    margin: 0px;
    border: 1px solid black;
  }
  #calibration label{
    display: inline-block;
    width: 300px;
    margin: 0px;
  }
  #calibration label input[type=range]{
    width: 200px;
    margin: 0px;
  }
  #calibration label span{
    display: inline-block;
    width: 30px;
    margin: 0px;
  }
</style>

<div id="calibration">
  <h3>calibration</h3>
  <div class="preset">
    <button v="test0">test0</button>
    <button v="test1">test1</button>
    <button v="test2">test2</button>
    <button v="test3">test3</button>
    <button v="test4">test4</button>
    <button v="test5">test5</button>
  </div>
  <div>
    <h4>servo_number:</h4>
    <label>
      <select name="servo_number">
        <option class="servo_number" value="0"  pulse_width="">A-1</option>
        <option class="servo_number" value="1"  pulse_width="">A-2</option>
        <option class="servo_number" value="2"  pulse_width="">A-3</option>
        <option class="servo_number" value="3"  pulse_width="">B-1</option>
        <option class="servo_number" value="4"  pulse_width="">B-2</option>
        <option class="servo_number" value="5"  pulse_width="">B-3</option>
        <option class="servo_number" value="6"  pulse_width="">C-1</option>
        <option class="servo_number" value="7"  pulse_width="">C-2</option>
        <option class="servo_number" value="8"  pulse_width="">C-3</option>
        <option class="servo_number" value="9"  pulse_width="">D-1</option>
        <option class="servo_number" value="10" pulse_width="">D-2</option>
        <option class="servo_number" value="11" pulse_width="">D-3</option>
      </select>
    </label>
  </div>

  <div>
    <h4>angle0:</h4>
    <label>
      angle0:
      <input type="text" name="angle0">
    </label>
    <label>
      pulse_width0:
      <input type="text" name="pulse_width0">
    </label>
  </div>
  <div>
    <h4>angle1:</h4>
    <label>
      angle1:
      <input type="text" name="angle1">
    </label>
    <label>
      pulse_width1:
      <input type="text" name="pulse_width1">
    </label>
  </div>
  <div>
    <h4>min/max:</h4>
    <label>
      angle_min:
      <input type="text" name="angle_min">
    </label>
    <label>
      angle_max:
      <input type="text" name="angle_max">
    </label>
  </div>
  <div>
    <button name="save_calibration">save</button>
  </div>
  <div>
    <h4>test:</h4>
    <div>
      <button class="test_pulse_width_all" v="0=2000,1=2000,2= 750, 3=1000,4=1000,5=2250, 6=2000,7=2000,8= 750, 9=1000,10=1000,11=2250">ALL:initial</button>
      <button class="test_pulse_width_all" v="0=1500,1=1500,2=1500, 3=1500,4=1500,5=1500, 6=1500,7=1500,8=1500, 9=1500,10=1500,11=1500">ALL:center(1500)</button>
    </div>
    <div>
        pulse_width:<input type="text" name="test_pulse_width">
      <button class="test_pulse_width" v="">test</button>
      <button class="test_pulse_width" v="1000">1000</button>
      <button class="test_pulse_width" v="1500">1500</button>
      <button class="test_pulse_width" v="2000">2000</button>
    </div>
    <div>
      <button class="test_pulse_width" v="-100">-100</button>
      <button class="test_pulse_width" v="-25">-25</button>
      <button class="test_pulse_width" v="-10">-10</button>
      <button class="test_pulse_width" v="-1">-1</button>
      <button class="test_pulse_width" v="+1">+1</button>
      <button class="test_pulse_width" v="+10">+10</button>
      <button class="test_pulse_width" v="+15">+25</button>
      <button class="test_pulse_width" v="+100">+100</button>
    </div>
  </div>
</div>
